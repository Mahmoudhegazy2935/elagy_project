<app-navebar></app-navebar>
<div class="content-with-navbar container  p-4 rounded border w-100" style="margin-top: 80px; border: 1px; direction: rtl;">
  <div class="text-center mb-3">
    <img class="w-50" src="../../../../assets/๐ฆ illustration _Order Confirmed_.png"  alt="">
  </div>
  <h2 class="text-center mb-2">ุชู ุงุณุชูุงู ุทูุจู ุจูุฌุงุญ</h2>
  <h4 class="text-center mb-4">ุงูุชุธุฑ ูุจูู ุทูุจู</h4>
  <hr>

  <div class="d-flex justify-content-end mb-4">
    <button class="btn btn-primary ms-2" [routerLink]="['/home']">ุชูุงุจูุน ุงูุชูุณูู</button>
    <button class="btn btn-outline-success" (click)="toggleNearby()">
      {{ showNearby ? 'ุฅุฎูุงุก ุงูุตูุฏููุงุช ุงููุฑูุจุฉ' : 'ุนุฑุถ ุงูุตูุฏููุงุช ุงููุฑูุจุฉ' }}
    </button>
  </div>

  <div class="row justify-content-center">

    <!-- Nearby Pharmacies -->
    @if (showNearby) {
      <div class="col-md-4 mb-4">
        <div class="card p-3 shadow-sm">
          <h5 class="mb- text-center">ุงูุตูุฏููุงุช ุงููุฑูุจุฉ ููู</h5>
          <hr>
          @if (!loading) {
            @for (pharmacy of nearbyPharmacies; track $index) {
              <div style="font-size: 20px;" class="btn btn-outline-primary w-100 mb-2">
                {{ pharmacy.name }}
                <p style="color: black; font-size: 15px;">ุงูุนููุงู : {{pharmacy.location}}</p>
                <p style="color: black; font-size: 15px;">ุงููุงุชู : {{pharmacy.phoneNumber}}</p>
              </div>
            }
          }
          @if (loading) {
            <div class="text-center w-100">
              <app-spinner></app-spinner>
            </div>
          }
        </div>
      </div>
    }

    <!-- Main Content Area -->
    <div class="col-md-8">

      @if (orders.length == 0 && roshtas.length == 0) {
        <div class="alert alert-warning text-center">
          ูุง ููุฌุฏ ููุชุฌุงุช
        </div>
      }
      @if (!loading) {
        @if (orders.length > 0) {
          @for (order of orders; track $index) {
            <div class="card mb-4 p-3 shadow rounded" style="background-color: #f9f9f9;">
              <h5 class="mb-2">๐ ูุชู ุงูุชูุตูู ุงูู:</h5>
              <p class="mb-3">{{ userAddress }}</p>
              <hr>
              <h6>๐ฆ ููุชุฌุงุช ุงูุดุญูุฉ</h6>

              <div class="row">
                @for (item of order.items; track $index) {
                  <div class="col-md-6 mb-3">
                    <div class="border p-2 h-100 rounded bg-light">
                      <p class="mb-1 fw-bold">{{ item.productName }}</p>
                      <p class="mb-1">ุงููููุฉ: {{ item.quantity }}</p>
                      <p class="mb-1">ุงูุณุนุฑ: {{ item.priceProduct }} ุฌููู</p>
                    </div>
                  </div>
                }
              </div>

              <hr>
              <p><b>๐ฐ ุงูุณุนุฑ ุงูุฅุฌูุงูู:</b> {{ getTotal(order.items) }} ุฌููู</p>
              <p><b>๐ ุณุนุฑ ุงูุดุญู:</b> ุญุชู 20 ุฌููู </p>
              @if (order.status ==='ููุฏ ุงููุนุงูุฌุฉ') {
                <p><b>๐ ุงูุญุงูุฉ:</b>  {{ order.status }} - ุณูุชู ุงูุชูุงุตู ูุนู</p>
                <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
              } @else {
                <p><b>๐ ุงูุญุงูุฉ:</b>  {{ order.status }} - ุณูุชู ุงูุชูุงุตู ูุนู</p>
              }
            </div>
          }
        }

        @if (roshtas.length > 0) {
          @for (roshta of roshtas; track $index) {
            <div class="card mb-4 p-3 shadow rounded" style="background-color: #f9f9f9;">
              <h5 class="mb-2">๐ ูุชู ุงูุชูุตูู ุงูู:</h5>
              <p class="mb-3">{{ userAddress }}</p>
              <hr>
              <h6>๐ฆ ุงูุฑูุดุชุฉ</h6>
              <div class="row">
                <div class="text-center my-3">
                  <img
                    [src]="'https://elagy-apii.runasp.net/' + roshta.imagePath"
                    alt="ุตูุฑุฉ ุงูุฑูุดุชุฉ"
                    class="img-thumbnail"
                    style="max-height: 150px; cursor: pointer;"
                    (click)="openImage(roshta.imagePath)">
                  <p class="mt-1 text-muted small">๐ท ุงุถุบุท ุนูู ุงูุตูุฑุฉ ูุชูุจูุฑูุง</p>
                </div>
              </div>

              <hr>
              <p><b>๐ฐ ุงูุณุนุฑ ุงูุฅุฌูุงูู:</b> {{ roshta.price }} ุฌููู</p>
              <p><b>๐ ุณุนุฑ ุงูุดุญู:</b> ุญุชู 20 ุฌููู </p>
              @if (roshta.status ==='ููุฏ ุงููุนุงูุฌุฉ') {
                <p><b>๐ ุงูุญุงูุฉ:</b>  {{ roshta.status }} - ุณูุชู ุงูุชูุงุตู ูุนู</p>
                <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
              } @else {
                <p><b>๐ ุงูุญุงูุฉ:</b>  {{ roshta.status }} - ุณูุชู ุงูุชูุงุตู ูุนู</p>
              }
            </div>
          }
        }
      }
      @if (loading) {
        <div class="text-center w-100">
          <app-spinner></app-spinner>
        </div>
      }
    </div>
  </div>
</div>
